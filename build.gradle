/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.4.1/userguide/tutorial_java_projects.html
 */
plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building an application
    id 'application'

    // plugin para carregamento e geração de classes do jooq
    id 'nu.studer.jooq' version '3.0.3'


}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}


ext {
    vertJOOQVersion = '4.1.0'
    vertxVersion = '3.7.1'
    junitJupiterEngineVersion = '5.4.0'
}



dependencies {
    // This dependency is found on compile classpath of this component and consumers.
    // implementation 'com.google.guava:guava:27.0.1-jre'


    compile('io.reactiverse:reactive-pg-client:0.11.4')
    compile ('org.jooq:jooq')
    compile ("io.github.jklingsporn:vertx-jooq-rx-reactive:$vertJOOQVersion")

    compile("io.vertx:vertx-core:$vertxVersion")
    compile("io.vertx:vertx-web:$vertxVersion")

    // Use JUnit test framework
    testImplementation 'junit:junit:4.12'

    // dependencia para o driver que será utilizado pelo JOOQ para conexão com o banco de dados
    jooqRuntime 'postgresql:postgresql:9.1-901.jdbc4'

    // jooqRuntime 'org.postgresql:postgresql:42.1.4'

    jooqRuntime("io.github.jklingsporn:vertx-jooq-rx-async:$vertJOOQVersion")
    // compile "io.github.jklingsporn:vertx-jooq-rx-async:$vertJOOQVersion"
    jooqRuntime("io.github.jklingsporn:vertx-jooq-generate:$vertJOOQVersion")

    // https://mvnrepository.com/artifact/javax.annotation/javax.annotation-api
    compile group: 'javax.annotation', name: 'javax.annotation-api', version: '1.3.2'

}

// Define the main class for the application
mainClassName = 'io.abner.vertx.exemplo.App'

jooq {
    version = '3.11.11' // the default (can be omitted)
    edition = 'OSS'    // the default (can be omitted), other allowed values are PRO, PRO_JAVA_6, and TRIAL

    projetoExemplo(sourceSets.main) {
        jdbc {
            driver = 'org.postgresql.Driver'
            url = 'jdbc:postgresql://localhost:5432/projeto_exemplo'
            user = 'root'
            password = 'r3dfr0g'
            properties {
                // property {
                //   key = 'ssl'
                //   value = 'true'
                // }
            }
        }
        generator {
            name = 'io.github.jklingsporn.vertx.jooq.generate.rx.RXReactiveVertxGenerator'
            //name = 'io.github.jklingsporn.vertx.jooq.generate.completablefuture.CompletableFutureAsyncVertxGenerator'
            strategy {
                name = 'io.github.jklingsporn.vertx.jooq.generate.VertxGeneratorStrategy'
                // ...
            }
            database {
                name = 'org.jooq.meta.postgres.PostgresDatabase'
                inputSchema = 'public'
                forcedTypes {
                    // How to bind jsonb to JsonObject -> https://www.jooq.org/doc/3.11/manual/code-generation/custom-data-type-bindings/
                     forcedType {
                       userType = 'io.vertx.core.json.JsonObject'
                       converter = 'io.abner.vertx.exemplo.jooq.JsonbConverter'
                         // binding ='io.abner.vertx.exemplo.jooq.ObjectToJsonObjectBinding'
                       // expression = 'conteudo'
                       types = 'jsonb?'

                     }
                     forcedType {
                       name = 'varchar'
                       expression = '.*'
                       types = 'JSONB?'
                     }
                    forcedType {
                        name = 'varchar'
                        expression = '.*'
                        types = 'INET'
                    }
                }
                // ...
            }
            generate {
                relations = true
                deprecated = false
                records = false
                immutablePojos = false
                fluentSetters = true
                daos = true
                // ...
            }
            target {
                packageName = 'io.abner.vertx.jooq'
                // directory = ...
            }
        }
    }
}

// REFERENCIAS:
// - https://github.com/abner/vertx-gradle-estaleiro/blob/master/web-template-gradle/build.gradle
// - https://github.com/etiennestuder/gradle-jooq-plugin